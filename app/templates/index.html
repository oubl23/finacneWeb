{% extends "base.html" %}
{% block title %}
    对账
{% endblock %}
{% block content %}
{#<div class="jumbotron" id="finance-container">#}
{#</div>#}
{#</div>#}
{#<form id="upload-file" method="post" enctype="multipart/form-data">#}
{#    <fieldset>#}
{#        <label for="file">Select a file</label>#}
{#        <input name="file" type="file">#}
{#    </fieldset>#}
{#    <fieldset>#}
{#        <button id="upload-file-btn" type="button">Upload</button>#}
{#    </fieldset>#}
{#</form>#}

<form method="post"  id="data" enctype="multipart/form-data">
    <fieldset>
        <label for="file">Select a file</label>
        <input name="file" type="file">
    </fieldset>
{#    上传excel文件<input type="file" name="file" title="Change" class="btn btn-small btn-info m-b-small" >#}
    <table class="table table-striped">
        <thead>
            <tr>
                <th>账户名</th>
                <th>账户别名</th>
                <th>上次对账时间</th>
                <th>余额/剩余额度</th>
                <th>额度/附属理财</th>
            </tr>
        </thead>
        <tbody>
            {% for account in accounts  %}
                <tr>
                    <td>{{ account.NAME  }}</td>
                    <td>{{ account.SHORT_NAME }}</td>
                    <td>{{ account.DATETIME }}</td>
                    <td class="col-sm-2">
                        <input type="text" class="form-control input-sm" name="balance[{{ account.ID }}][MONEY]">
                    </td>
                    <td class="col-sm-2">
                        {% if account.LIMIT != 0 %}
                            <div class="form-group has-success">
                                <input type="text" class="form-control input-sm" value="{{ account.LIMIT }}"  name="balance[{{ account.ID }}][ACCESSARY]" readonly>
                            </div>
                        {% else %}
                            <div class="form-group">
                                {% if account.ACCESSARY == '' %}
                                    <input type="text" class="form-control input-sm" name="balance[{{ account.ID }}][ACCESSARY]" readonly>
                                {% else %}
                                    <input type="text" class="form-control input-sm" name="balance[{{ account.ID }}][ACCESSARY]" placeholder="{{ account.ACCESSARY }}" >
                                {% endif %}
                            </div>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="form-group col-lg-2 pull-right">
        <input class="form-control btn-primary" id="upload-file-btn" type="button" value="提交">
    </div>
</form>
{#<pre id="result"></pre>#}
{#<script type="text/javascript" src="../static/js/build/bundle.js"></script>#}
<script type="application/javascript">

$(function() {
    $('form').submit(function() {
        add();
        return false;
    });
});
function add() {
    balances = $('form').serializeObject();
        $.ajax({
            type:"post",
            url:"/add_balance",
            data:{balance:JSON.stringify(balances)},
            dataType: 'json'
        });
}

$(function() {
    $('#upload-file-btn').click(function() {
        var form_data = new FormData($('form#data')[0]);
        $.ajax({
            type: 'POST',
            url: '/add_balance',
            data: form_data,
            contentType: false,
            cache: false,
            processData: false,
            async: false,
            success: function(data) {
                console.log('Success!');
            },
        });
    });
});
</script>
{% endblock %}

